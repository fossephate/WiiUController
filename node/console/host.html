<html>

<head>

	<title>Lagless audio host</title>
<!-- 	<script src="https://cdn.webrtc-experiment.com/socket.io.js"></script> -->
<!-- 	<script src="/8110/socket.io.js"></script> -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.0/socket.io.js"></script>
	<script src="js/meeting-host.js"></script>
</head>

<body>
	
	<script>
		var hash = window.location.hash.replace("#", "");
		var meeting = new Meeting(hash);
		//var remoteMediaStreams = document.getElementById('remote-media-streams');
		//var localMediaStream = document.getElementById('local-media-stream');
		var channel = "#twitchplaysnintendoswitch";
		var sender = Math.round(Math.random() * 999999999) + 999999999;
		//var SIGNALING_SERVER = 'https://socketio-over-nodejs2.herokuapp.com:443/';
		//var SIGNALING_SERVER = 'https://twitchplaysnintendoswitch.com/8110/';
		var socket = io("https://twitchplaysnintendoswitch.com", {
			path: "/8110/socket.io/",
			transports: ['websocket'] // added
		});
		socket.emit('new-channel', {
			channel: channel,
			sender: sender
		});
		//socket = io.connect(SIGNALING_SERVER + channel);
		io.connect("https://twitchplaysnintendoswitch.com", {
			path: "/8110/socket.io/",
			transports: ["websocket"] // added
		});
		socket.on("connect", function() {
			// setup peer connection & pass socket object over the constructor!
		});
		socket.send = function(message) {
			socket.emit("message", {
				sender: sender,
				data: message
			});
		};
		meeting.openSignalingChannel = function(callback) {
			return socket.on("message", callback);
		};
		// on getting media stream
		meeting.onaddstream = function(e) {
			//if (e.type == 'local') localMediaStream.appendChild(e.audio);
			//if (e.type == 'remote') remoteMediaStreams.insertBefore(e.audio, remoteMediaStreams.firstChild);
		};
		// using firebase for signaling
		meeting.firebase = "rtcweb";
		// if someone leaves; just remove their audio
		meeting.onuserleft = function(userid) {
			var audio = document.getElementById(userid);
			if (audio) audio.parentNode.removeChild(audio);
		};
		// check pre-created meeting rooms
		meeting.check();
		meeting.setup("meeting room name");
	</script>
</body>

</html>